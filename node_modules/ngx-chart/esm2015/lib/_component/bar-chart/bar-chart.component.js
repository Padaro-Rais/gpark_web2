import { __decorate } from "tslib";
import { Component, EventEmitter, Input, Output, } from '@angular/core';
let BarChartComponent = class BarChartComponent {
    constructor() {
        this.selectedItem = new EventEmitter();
        this.chartData = [];
        this.chartOptions = {
            roundedCorners: false,
            isHorizontal: false,
            showLegend: true,
            legendTitle: 'Total',
        };
        this.view = {
            height: 200,
            width: 200
        };
        this.lines = [];
        this.totalSum = 0;
        this.isHorizontal = true;
        this.barLineType = 'round';
        this.chartView = [];
        this.scale = 100;
    }
    ngOnInit() {
        this.chartView.push(this.view.height + 'px');
        this.chartView.push(this.view.width + 'px');
        this.barLineType = this.chartOptions['roundedCorners'] ? 'round' : 'butt';
        this.isHorizontal = this.chartOptions['isHorizontal'] ? true : false;
        this.scale = this.isHorizontal ? this.view.width : this.view.height;
        this.getTotalSum(this.chartData);
        let value = Math.max.apply(Math, this.chartData.map(function (o) {
            return o.value;
        }));
        if (value > this.scale) {
            let normalizedValue = value / this.scale;
            this.chartData.map((y, index) => {
                this.chartData[index]['normalized'] = Number(y.value) / normalizedValue;
            });
        }
        else {
            let normalizedValue = this.scale / value;
            this.chartData.map((y, index) => {
                this.chartData[index]['normalized'] = Number(y.value) * normalizedValue;
            });
        }
        this.lines = this.isHorizontal ? this.calculateHorizontalBarLines(this.chartData) : this.calculateVerticalBarLines(this.chartData);
    }
    ngAfterViewInit() { }
    getItemClicked(line) {
        let selectedbar = {
            name: line.name,
            value: line.value
        };
        this.selectedItem.emit(JSON.stringify(selectedbar));
    }
    calculateHorizontalBarLines(graphData) {
        let barLines = [];
        graphData.map((x, index) => {
            let background = {
                x1: 10,
                y1: index * 20 + 20,
                y2: index * 20 + 20,
                x2: this.view.width,
                color: '#EBEBEB',
                name: x.name,
                value: x.value
            };
            barLines.push(background);
            if (x.value > 0) {
                let line = {
                    x1: 10,
                    y1: index * 20 + 20,
                    y2: index * 20 + 20,
                    x2: x.normalized < 10 ? this.barLineType == 'butt' ? 11 : 10 : x.normalized,
                    color: x.color,
                    name: x.name,
                    value: x.value
                };
                barLines.push(line);
            }
        });
        return barLines;
    }
    calculateVerticalBarLines(graphData) {
        let barLines = [];
        graphData.map((x, index) => {
            let background = {
                x1: index * 20 + 20,
                y1: 10,
                x2: index * 20 + 20,
                y2: this.scale,
                color: '#EBEBEB',
                name: x.name,
                value: x.value
            };
            barLines.push(background);
            if (x.value > 0) {
                let line = {
                    x1: index * 20 + 20,
                    y1: (this.scale + 10) - x.normalized > this.scale ? this.barLineType == 'butt' ? (this.scale - 1) : this.scale : (this.scale + 10) - x.normalized,
                    x2: index * 20 + 20,
                    y2: this.scale,
                    color: x.color,
                    name: x.name,
                    value: x.value
                };
                barLines.push(line);
            }
        });
        console.log(barLines);
        return barLines;
    }
    getTotalSum(chartData) {
        // Get total number of records
        this.totalSum = chartData.reduce(function (a, b) {
            return a + parseInt(b.value);
        }, 0);
    }
};
__decorate([
    Output()
], BarChartComponent.prototype, "selectedItem", void 0);
__decorate([
    Input()
], BarChartComponent.prototype, "chartData", void 0);
__decorate([
    Input()
], BarChartComponent.prototype, "chartOptions", void 0);
__decorate([
    Input()
], BarChartComponent.prototype, "view", void 0);
BarChartComponent = __decorate([
    Component({
        selector: 'ngx-bar-chart',
        template: "<div class=\"chart-view  ngx-bar\">\r\n  <div class=\"chart-wrapper\" [ngStyle]=\"{'height': chartView[0],'width': chartView[1]}\">\r\n    <svg id=\"lines\" [attr.viewBox]=\"'0 0 '+ (isHorizontal ? scale+40 : (lines[lines.length-1].x1 + 20))+' ' + (isHorizontal ? (lines[lines.length-1].y2 + 20) : (scale+20))\">\r\n      <g>\r\n        <line *ngFor=\"let line of lines\" stroke-width=\"10\" class=\"line\" [attr.x1]=\"line.x1\" [attr.y1]=\"line.y1 \"\r\n          [attr.x2]=\"line.x2\" [attr.y2]=\"line.y2\" [attr.stroke]=\"line.color\" \u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0 [attr.stroke-linecap]=\"barLineType\"\r\n          [attr.title]=\"line.name\" (click)=\"getItemClicked(line)\" chartTooltip tooltip={{line.name}} />\r\n      </g>\r\n    </svg>\r\n  </div>\r\n  <div class=\"legend\" *ngIf=\"chartOptions.showLegend\">\r\n    <h4>{{chartOptions.legendTitle +' : '+ totalSum}}</h4>\r\n    <div class=\"legend-item\" *ngFor=\"let item of chartData; let i=index\">\r\n      <div class=\"legend-item-colour\" [ngStyle]=\"{'background': item.color}\"></div><span\r\n        class=\"legend-item-name\">{{item.name}}</span><span class=\"legend-item-value\">{{item.value}}</span>\r\n    </div>\r\n  </div>\r\n\r\n</div>",
        styles: [".line{cursor:pointer}"]
    })
], BarChartComponent);
export { BarChartComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFyLWNoYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1jaGFydC8iLCJzb3VyY2VzIjpbImxpYi9fY29tcG9uZW50L2Jhci1jaGFydC9iYXItY2hhcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ1UsU0FBUyxFQUFjLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxHQUMxRSxNQUFNLGVBQWUsQ0FBQztBQVV2QixJQUFhLGlCQUFpQixHQUE5QixNQUFhLGlCQUFpQjtJQW1CNUI7UUFsQlUsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQzNDLGNBQVMsR0FBZ0IsRUFBRSxDQUFDO1FBQzVCLGlCQUFZLEdBQW1CO1lBQ3RDLGNBQWMsRUFBRSxLQUFLO1lBQ3JCLFlBQVksRUFBRSxLQUFLO1lBQ25CLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFdBQVcsRUFBRSxPQUFPO1NBQ3JCLENBQUM7UUFDTyxTQUFJLEdBQWM7WUFDekIsTUFBTSxFQUFFLEdBQUc7WUFDWCxLQUFLLEVBQUUsR0FBRztTQUNYLENBQUM7UUFDRixVQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ1gsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUNiLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLGdCQUFXLEdBQUcsT0FBTyxDQUFBO1FBQ3JCLGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixVQUFLLEdBQUcsR0FBRyxDQUFDO0lBQ0ksQ0FBQztJQUVqQixRQUFRO1FBRU4sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDNUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFFM0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFD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QUMsQ0FBQztRQUMvQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDUixDQUFDO0NBQ0YsQ0FBQTtBQXpJVztJQUFULE1BQU0sRUFBRTt1REFBMkM7QUFDM0M7SUFBUixLQUFLLEVBQUU7b0RBQTZCO0FBQzVCO0lBQVIsS0FBSyxFQUFFO3VEQUtOO0FBQ087SUFBUixLQUFLLEVBQUU7K0NBR047QUFaUyxpQkFBaUI7SUFMN0IsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLGVBQWU7UUFDekIsb3RDQUF5Qzs7S0FFMUMsQ0FBQztHQUNXLGlCQUFpQixDQTBJN0I7U0ExSVksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBWaWV3Q2hpbGQsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJhckNoYXJ0T3B0aW9uIH0gZnJvbSAnLi4vLi4vX21vZGVsL2JhckNoYXJ0T3B0aW9ucyc7XHJcbmltcG9ydCB7IENoYXJ0RGF0YSwgQ2hhcnRWaWV3IH0gZnJvbSAnLi4vLi4vX21vZGVsL2NoYXJ0RGF0YSc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICduZ3gtYmFyLWNoYXJ0JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYmFyLWNoYXJ0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9iYXItY2hhcnQuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQmFyQ2hhcnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG4gIEBPdXRwdXQoKSBzZWxlY3RlZEl0ZW0gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuICBASW5wdXQoKSBjaGFydERhdGE6IENoYXJ0RGF0YVtdID0gW107XHJcbiAgQElucHV0KCkgY2hhcnRPcHRpb25zOiBCYXJDaGFydE9wdGlvbiA9IHtcclxuICAgIHJvdW5kZWRDb3JuZXJzOiBmYWxzZSxcclxuICAgIGlzSG9yaXpvbnRhbDogZmFsc2UsXHJcbiAgICBzaG93TGVnZW5kOiB0cnVlLFxyXG4gICAgbGVnZW5kVGl0bGU6ICdUb3RhbCcsXHJcbiAgfTtcclxuICBASW5wdXQoKSB2aWV3OiBDaGFydFZpZXcgPSB7XHJcbiAgICBoZWlnaHQ6IDIwMCxcclxuICAgIHdpZHRoOiAyMDBcclxuICB9O1xyXG4gIGxpbmVzID0gW107XHJcbiAgdG90YWxTdW0gPSAwO1xyXG4gIGlzSG9yaXpvbnRhbCA9IHRydWU7XHJcbiAgYmFyTGluZVR5cGUgPSAncm91bmQnXHJcbiAgY2hhcnRWaWV3ID0gW107XHJcbiAgc2NhbGUgPSAxMDA7XHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcblxyXG4gICAgdGhpcy5jaGFydFZpZXcucHVzaCh0aGlzLnZpZXcuaGVpZ2h0ICsgJ3B4JylcclxuICAgIHRoaXMuY2hhcnRWaWV3LnB1c2godGhpcy52aWV3LndpZHRoICsgJ3B4JylcclxuXHJcbiAgICB0aGlzLmJhckxpbmVUeXBlID0gdGhpcy5jaGFydE9wdGlvbnNbJ3JvdW5kZWRDb3JuZXJzJ10gPyAncm91bmQnIDogJ2J1dHQnXHJcbiAgICB0aGlzLmlzSG9yaXpvbnRhbCA9IHRoaXMuY2hhcnRPcHRpb25zWydpc0hvcml6b250YWwnXSA/IHRydWUgOiBmYWxzZTtcclxuICAgIHRoaXMuc2NhbGUgPSB0aGlzLmlzSG9yaXpvbnRhbCA/IHRoaXMudmlldy53aWR0aCA6IHRoaXMudmlldy5oZWlnaHQ7XHJcblxyXG4gICAgXHJcblxyXG4gICAgdGhpcy5nZXRUb3RhbFN1bSh0aGlzLmNoYXJ0RGF0YSk7XHJcbiAgICBsZXQgdmFsdWUgPSBNYXRoLm1heC5hcHBseShcclxuICAgICAgTWF0aCxcclxuICAgICAgdGhpcy5jaGFydERhdGEubWFwKGZ1bmN0aW9uIChvKSB7XHJcbiAgICAgICAgcmV0dXJuIG8udmFsdWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgaWYgKHZhbHVlID4gdGhpcy5zY2FsZSkge1xyXG4gICAgICBsZXQgbm9ybWFsaXplZFZhbHVlID0gdmFsdWUgLyB0aGlzLnNjYWxlO1xyXG4gICAgICB0aGlzLmNoYXJ0RGF0YS5tYXAoKHksIGluZGV4KSA9PiB7XHJcbiAgICAgICAgdGhpcy5jaGFydERhdGFbaW5kZXhdWydub3JtYWxpemVkJ10gPSBOdW1iZXIoeS52YWx1ZSkgLyBub3JtYWxpemVkVmFsdWU7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IG5vcm1hbGl6ZWRWYWx1ZSA9IHRoaXMuc2NhbGUgLyB2YWx1ZTtcclxuICAgICAgdGhpcy5jaGFydERhdGEubWFwKCh5LCBpbmRleCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2hhcnREYXRhW2luZGV4XVsnbm9ybWFsaXplZCddID0gTnVtYmVyKHkudmFsdWUpICogbm9ybWFsaXplZFZhbHVlO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmxpbmVzID0gdGhpcy5pc0hvcml6b250YWwgPyB0aGlzLmNhbGN1bGF0ZUhvcml6b250YWxCYXJMaW5lcyh0aGlzLmNoYXJ0RGF0YSkgOiB0aGlzLmNhbGN1bGF0ZVZlcnRpY2FsQmFyTGluZXModGhpcy5jaGFydERhdGEpO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQgeyB9XHJcblxyXG4gIGdldEl0ZW1DbGlja2VkKGxpbmUpIHtcclxuICAgIGxldCBzZWxlY3RlZGJhciA9IHtcclxuICAgICAgbmFtZTogbGluZS5uYW1lLFxyXG4gICAgICB2YWx1ZTogbGluZS52YWx1ZVxyXG4gICAgfVxyXG4gICAgdGhpcy5zZWxlY3RlZEl0ZW0uZW1pdChKU09OLnN0cmluZ2lmeShzZWxlY3RlZGJhcikpO1xyXG4gIH1cclxuXHJcbiAgY2FsY3VsYXRlSG9yaXpvbnRhbEJhckxpbmVzKGdyYXBoRGF0YSkge1xyXG4gICAgbGV0IGJhckxpbmVzID0gW107XHJcbiAgICBncmFwaERhdGEubWFwKCh4LCBpbmRleCkgPT4ge1xyXG4gICAgICBsZXQgYmFja2dyb3VuZCA9IHtcclxuICAgICAgICB4MTogMTAsXHJcbiAgICAgICAgeTE6IGluZGV4ICogMjAgKyAyMCxcclxuICAgICAgICB5MjogaW5kZXggKiAyMCArIDIwLFxyXG4gICAgICAgIHgyOiB0aGlzLnZpZXcud2lkdGgsXHJcbiAgICAgICAgY29sb3I6ICcjRUJFQkVCJyxcclxuICAgICAgICBuYW1lOiB4Lm5hbWUsXHJcbiAgICAgICAgdmFsdWU6IHgudmFsdWVcclxuICAgICAgfTtcclxuICAgICAgYmFyTGluZXMucHVzaChiYWNrZ3JvdW5kKVxyXG5cclxuICAgICAgaWYgKHgudmFsdWUgPiAwKSB7XHJcbiAgICAgICAgbGV0IGxpbmUgPSB7XHJcbiAgICAgICAgICB4MTogMTAsXHJcbiAgICAgICAgICB5MTogaW5kZXggKiAyMCArIDIwLFxyXG4gICAgICAgICAgeTI6IGluZGV4ICogMjAgKyAyMCxcclxuICAgICAgICAgIHgyOiB4Lm5vcm1hbGl6ZWQgPCAxMCA/IHRoaXMuYmFyTGluZVR5cGUgPT0gJ2J1dHQnID8gMTEgOiAxMCA6IHgubm9ybWFsaXplZCxcclxuICAgICAgICAgIGNvbG9yOiB4LmNvbG9yLFxyXG4gICAgICAgICAgbmFtZTogeC5uYW1lLFxyXG4gICAgICAgICAgdmFsdWU6IHgudmFsdWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIGJhckxpbmVzLnB1c2gobGluZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBiYXJMaW5lcztcclxuICB9XHJcblxyXG5cclxuICBjYWxjdWxhdGVWZXJ0aWNhbEJhckxpbmVzKGdyYXBoRGF0YSkge1xyXG4gICAgbGV0IGJhckxpbmVzID0gW107XHJcblxyXG4gICAgZ3JhcGhEYXRhLm1hcCgoeCwgaW5kZXgpID0+IHtcclxuICAgICAgbGV0IGJhY2tncm91bmQgPSB7XHJcbiAgICAgICAgeDE6IGluZGV4ICogMjAgKyAyMCxcclxuICAgICAgICB5MTogMTAsXHJcbiAgICAgICAgeDI6IGluZGV4ICogMjAgKyAyMCxcclxuICAgICAgICB5MjogdGhpcy5zY2FsZSxcclxuICAgICAgICBjb2xvcjogJyNFQkVCRUInLFxyXG4gICAgICAgIG5hbWU6IHgubmFtZSxcclxuICAgICAgICB2YWx1ZTogeC52YWx1ZVxyXG4gICAgICB9O1xyXG4gICAgICBiYXJMaW5lcy5wdXNoKGJhY2tncm91bmQpXHJcblxyXG4gICAgICBpZiAoeC52YWx1ZSA+IDApIHtcclxuICAgICAgICBsZXQgbGluZSA9IHtcclxuICAgICAgICAgIHgxOiBpbmRleCAqIDIwICsgMjAsXHJcbiAgICAgICAgICB5MTogKHRoaXMuc2NhbGUrMTApIC0geC5ub3JtYWxpemVkID4gdGhpcy5zY2FsZSA/IHRoaXMuYmFyTGluZVR5cGUgPT0gJ2J1dHQnID8gKHRoaXMuc2NhbGUtMSkgOiB0aGlzLnNjYWxlIDogKHRoaXMuc2NhbGUrMTApIC0geC5ub3JtYWxpemVkLFxyXG4gICAgICAgICAgeDI6IGluZGV4ICogMjAgKyAyMCxcclxuICAgICAgICAgIHkyOiB0aGlzLnNjYWxlLFxyXG4gICAgICAgICAgY29sb3I6IHguY29sb3IsXHJcbiAgICAgICAgICBuYW1lOiB4Lm5hbWUsXHJcbiAgICAgICAgICB2YWx1ZTogeC52YWx1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgYmFyTGluZXMucHVzaChsaW5lKTtcclxuXHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICAgIGNvbnNvbGUubG9nKGJhckxpbmVzKVxyXG4gICAgcmV0dXJuIGJhckxpbmVzO1xyXG4gIH1cclxuXHJcblxyXG5cclxuICBnZXRUb3RhbFN1bShjaGFydERhdGEpIHtcclxuICAgIC8vIEdldCB0b3RhbCBudW1iZXIgb2YgcmVjb3Jkc1xyXG4gICAgdGhpcy50b3RhbFN1bSA9IGNoYXJ0RGF0YS5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgcmV0dXJuIGEgKyBwYXJzZUludChiLnZhbHVlKTtcclxuICAgIH0sIDApO1xyXG4gIH1cclxufSJdfQ==