{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/HK/Desktop/LIK_PROJECT/archiLik/Archive_Lik_Angular/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { EventEmitter } from \"@angular/core\";\nimport { isDefined, readFileAsDataURI } from \"../../../../../utils\";\nimport { map } from \"rxjs/operators\";\nimport { createSubject } from \"../../../../../rxjs/helpers\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@clr/angular\";\nimport * as i4 from \"../../../../dropzone/dropzone.component\";\nimport * as i5 from \"@ngx-translate/core\";\nconst _c0 = [\"dropzoneContainer\"];\n\nfunction DynamicFileInputComponent_ng_container_0_label_1_small_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 6);\n    i0.ɵɵtext(1, \" (*) \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DynamicFileInputComponent_ng_container_0_label_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, DynamicFileInputComponent_ng_container_0_label_1_small_2_Template, 2, 0, \"small\", 5);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"for\", ctx_r1.inputType.asFileInput(ctx_r1.inputConfig).formControlName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.inputConfig.label, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.inputType.asFileInput(ctx_r1.inputConfig).rules == null ? null : ctx_r1.inputType.asFileInput(ctx_r1.inputConfig).rules.isRequired);\n  }\n}\n\nfunction DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-dropzone\", 7, 8);\n    i0.ɵɵlistener(\"removedFile\", function DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template_app_dropzone_removedFile_0_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.onDropzoneFileRemoved($event);\n    })(\"addedFile\", function DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template_app_dropzone_addedFile_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.onDropzoneFileAdded();\n    });\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵpipe(4, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵclassMap(ctx_r2.inputConfig.classes);\n    i0.ɵɵproperty(\"dropzoneConfig\", ctx_r2.dropzoneConfigs)(\"uploadFileText\", i0.ɵɵpipeBind1(2, 6, \"uploadFileLabel\"))(\"dragFileText\", i0.ɵɵpipeBind1(3, 8, \"dragFileLabel\"))(\"defaultMessage\", i0.ɵɵpipeBind1(4, 10, \"upload\"));\n  }\n}\n\nfunction DynamicFileInputComponent_ng_container_0_clr_control_error_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"clr-control-error\", 9);\n    i0.ɵɵelement(1, \"span\", 10);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"translate\", \"validation.required\");\n  }\n}\n\nfunction DynamicFileInputComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, DynamicFileInputComponent_ng_container_0_label_1_Template, 3, 3, \"label\", 1);\n    i0.ɵɵtemplate(2, DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template, 5, 12, \"app-dropzone\", 2);\n    i0.ɵɵtemplate(3, DynamicFileInputComponent_ng_container_0_clr_control_error_3_Template, 2, 1, \"clr-control-error\", 3);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showLabelAndDescription);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.dropzoneConfigs);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.control.hasError(\"required\") && ctx_r0.control.touched);\n  }\n}\n\nexport class DynamicFileInputComponent {\n  constructor(inputType, path) {\n    this.inputType = inputType;\n    this.path = path;\n    this.controlDivContainerClass = \"clr-form-control\";\n    this.showLabelAndDescription = true;\n    this.addedEvent = new EventEmitter();\n    this.removedEvent = new EventEmitter();\n    this._destroy$ = createSubject();\n  }\n\n  ngOnInit() {\n    this.dropzoneConfigs = {\n      maxFiles: this.inputConfig.multiple ? 50 : 1,\n      maxFilesize: this.inputConfig.maxFileSize ? this.inputConfig.maxFileSize : 10,\n      url: isDefined(this.inputType.asFileInput(this.inputConfig).uploadUrl) && this.inputConfig.uploadUrl !== \"\" ? this.inputConfig.uploadUrl : this.path,\n      uploadMultiple: this.inputConfig.multiple ? this.inputConfig.multiple : false,\n      acceptedFiles: this.inputConfig.pattern\n    };\n    this.control.valueChanges.pipe(map(state => {\n      if (this.control.status.toLowerCase() === \"disabled\") {\n        this.dropzoneContainer.disabled = true;\n      } else {\n        this.dropzoneContainer.disabled = false;\n      }\n\n      if (!isDefined(state)) {\n        this.dropzoneContainer.resetDropzone();\n      }\n    }));\n  } // Files Handlers event method\n  // tslint:disable-next-line: typedef\n\n\n  onDropzoneFileAdded() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      setTimeout( /*#__PURE__*/_asyncToGenerator(function* () {\n        const files = _this.dropzoneContainer.dropzone().getAcceptedFiles();\n\n        if (_this.inputConfig.multiple) {\n          _this.control.setValue(yield Promise.all(files.map( /*#__PURE__*/function () {\n            var _ref2 = _asyncToGenerator(function* (v) {\n              return {\n                uuid: v.upload.uuid,\n                dataURL: yield readFileAsDataURI(v),\n                extension: v.name.split(\".\")[v.name.split(\".\").length - 1]\n              };\n            });\n\n            return function (_x) {\n              return _ref2.apply(this, arguments);\n            };\n          }())));\n        } else {\n          const file = files[0];\n\n          if (file) {\n            _this.control.setValue({\n              uuid: files[0].upload.uuid,\n              dataURL: yield readFileAsDataURI(files[0]),\n              extension: files[0].name.split(\".\")[files[0].name.split(\".\").length - 1]\n            });\n\n            _this.dropzoneContainer.disabled = true;\n          }\n        }\n\n        _this.addedEvent.emit(_this.control.value);\n      }), 50);\n    })();\n  } // tslint:disable-next-line: typedef\n\n\n  onDropzoneFileRemoved(event) {\n    if (this.inputConfig.multiple) {\n      if (isDefined(this.control.value)) {\n        this.control.setValue(this.control.value.filter(v => {\n          return v.uuid !== event.upload.uuid;\n        }));\n      }\n    } else {\n      this.control.setValue(null);\n    } // Enable the dropzpone if an item is removed from the dropzone and not supporting multiple upload\n\n\n    if (!this.inputConfig.multiple) {\n      this.dropzoneContainer.disabled = false;\n    }\n\n    this.removedEvent.emit();\n  }\n\n  ngOnDestroy() {\n    this._destroy$.next();\n  }\n\n}\n\nDynamicFileInputComponent.ɵfac = function DynamicFileInputComponent_Factory(t) {\n  return new (t || DynamicFileInputComponent)(i0.ɵɵdirectiveInject(i1.DynamicInputTypeHelper), i0.ɵɵdirectiveInject(\"FILE_STORE_PATH\"));\n};\n\nDynamicFileInputComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DynamicFileInputComponent,\n  selectors: [[\"app-dynamic-file-input\"]],\n  viewQuery: function DynamicFileInputComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.dropzoneContainer = _t.first);\n    }\n  },\n  inputs: {\n    controlDivContainerClass: \"controlDivContainerClass\",\n    control: \"control\",\n    showLabelAndDescription: \"showLabelAndDescription\",\n    inputConfig: \"inputConfig\"\n  },\n  outputs: {\n    addedEvent: \"addedEvent\",\n    removedEvent: \"removedEvent\"\n  },\n  decls: 1,\n  vars: 1,\n  consts: [[4, \"ngIf\"], [\"class\", \"clr-control-label\", 3, \"for\", 4, \"ngIf\"], [3, \"dropzoneConfig\", \"class\", \"uploadFileText\", \"dragFileText\", \"defaultMessage\", \"removedFile\", \"addedFile\", 4, \"ngIf\"], [\"class\", \"field-has-error\", 4, \"ngIf\"], [1, \"clr-control-label\", 3, \"for\"], [\"class\", \"required-text\", 4, \"ngIf\"], [1, \"required-text\"], [3, \"dropzoneConfig\", \"uploadFileText\", \"dragFileText\", \"defaultMessage\", \"removedFile\", \"addedFile\"], [\"dropzoneContainer\", \"\"], [1, \"field-has-error\"], [3, \"translate\"]],\n  template: function DynamicFileInputComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, DynamicFileInputComponent_ng_container_0_Template, 4, 3, \"ng-container\", 0);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.inputConfig);\n    }\n  },\n  directives: [i2.NgIf, i3.ClrLabel, i4.DropzoneComponent, i3.ClrControlError, i5.TranslateDirective],\n  pipes: [i5.TranslatePipe],\n  styles: [\".required-text[_ngcontent-%COMP%], .field-has-error[_ngcontent-%COMP%]{color:#f13232}.clr-input-wrapper[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]:disabled{background:rgba(244,244,244,.3)}.clr-control-label[_ngcontent-%COMP%]{margin-bottom:.5rem}\"]\n});","map":{"version":3,"sources":["C:/Users/HK/Desktop/LIK_PROJECT/archiLik/Archive_Lik_Angular/src/app/core/components/dynamic-inputs/angular/components/dynamic-file-input/dynamic-file-input.component.ts"],"names":["EventEmitter","isDefined","readFileAsDataURI","map","createSubject","i0","i1","i2","i3","i4","i5","_c0","DynamicFileInputComponent_ng_container_0_label_1_small_2_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","DynamicFileInputComponent_ng_container_0_label_1_Template","ɵɵtemplate","ctx_r1","ɵɵnextContext","ɵɵproperty","inputType","asFileInput","inputConfig","formControlName","ɵɵadvance","ɵɵtextInterpolate1","label","rules","isRequired","DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template","_r7","ɵɵgetCurrentView","ɵɵlistener","DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template_app_dropzone_removedFile_0_listener","$event","ɵɵrestoreView","ctx_r6","onDropzoneFileRemoved","DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template_app_dropzone_addedFile_0_listener","ctx_r8","onDropzoneFileAdded","ɵɵpipe","ctx_r2","ɵɵclassMap","classes","dropzoneConfigs","ɵɵpipeBind1","DynamicFileInputComponent_ng_container_0_clr_control_error_3_Template","ɵɵelement","DynamicFileInputComponent_ng_container_0_Template","ɵɵelementContainerStart","ɵɵelementContainerEnd","ctx_r0","showLabelAndDescription","control","hasError","touched","DynamicFileInputComponent","constructor","path","controlDivContainerClass","addedEvent","removedEvent","_destroy$","ngOnInit","maxFiles","multiple","maxFilesize","maxFileSize","url","uploadUrl","uploadMultiple","acceptedFiles","pattern","valueChanges","pipe","state","status","toLowerCase","dropzoneContainer","disabled","resetDropzone","setTimeout","files","dropzone","getAcceptedFiles","setValue","Promise","all","v","uuid","upload","dataURL","extension","name","split","length","file","emit","value","event","filter","ngOnDestroy","next","ɵfac","DynamicFileInputComponent_Factory","t","ɵɵdirectiveInject","DynamicInputTypeHelper","ɵcmp","ɵɵdefineComponent","type","selectors","viewQuery","DynamicFileInputComponent_Query","ɵɵviewQuery","_t","ɵɵqueryRefresh","ɵɵloadQuery","first","inputs","outputs","decls","vars","consts","template","DynamicFileInputComponent_Template","directives","NgIf","ClrLabel","DropzoneComponent","ClrControlError","TranslateDirective","pipes","TranslatePipe","styles"],"mappings":"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","sourcesContent":["import { EventEmitter, } from \"@angular/core\";\r\nimport { isDefined, readFileAsDataURI } from \"../../../../../utils\";\r\nimport { map } from \"rxjs/operators\";\r\nimport { createSubject } from \"../../../../../rxjs/helpers\";\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"../../services\";\r\nimport * as i2 from \"@angular/common\";\r\nimport * as i3 from \"@clr/angular\";\r\nimport * as i4 from \"../../../../dropzone/dropzone.component\";\r\nimport * as i5 from \"@ngx-translate/core\";\r\nconst _c0 = [\"dropzoneContainer\"];\r\nfunction DynamicFileInputComponent_ng_container_0_label_1_small_2_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"small\", 6);\r\n    i0.ɵɵtext(1, \" (*) \");\r\n    i0.ɵɵelementEnd();\r\n} }\r\nfunction DynamicFileInputComponent_ng_container_0_label_1_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"label\", 4);\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵtemplate(2, DynamicFileInputComponent_ng_container_0_label_1_small_2_Template, 2, 0, \"small\", 5);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r1 = i0.ɵɵnextContext(2);\r\n    i0.ɵɵproperty(\"for\", ctx_r1.inputType.asFileInput(ctx_r1.inputConfig).formControlName);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.inputConfig.label, \" \");\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.inputType.asFileInput(ctx_r1.inputConfig).rules == null ? null : ctx_r1.inputType.asFileInput(ctx_r1.inputConfig).rules.isRequired);\r\n} }\r\nfunction DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template(rf, ctx) { if (rf & 1) {\r\n    const _r7 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementStart(0, \"app-dropzone\", 7, 8);\r\n    i0.ɵɵlistener(\"removedFile\", function DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template_app_dropzone_removedFile_0_listener($event) { i0.ɵɵrestoreView(_r7); const ctx_r6 = i0.ɵɵnextContext(2); return ctx_r6.onDropzoneFileRemoved($event); })(\"addedFile\", function DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template_app_dropzone_addedFile_0_listener() { i0.ɵɵrestoreView(_r7); const ctx_r8 = i0.ɵɵnextContext(2); return ctx_r8.onDropzoneFileAdded(); });\r\n    i0.ɵɵpipe(2, \"translate\");\r\n    i0.ɵɵpipe(3, \"translate\");\r\n    i0.ɵɵpipe(4, \"translate\");\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r2 = i0.ɵɵnextContext(2);\r\n    i0.ɵɵclassMap(ctx_r2.inputConfig.classes);\r\n    i0.ɵɵproperty(\"dropzoneConfig\", ctx_r2.dropzoneConfigs)(\"uploadFileText\", i0.ɵɵpipeBind1(2, 6, \"uploadFileLabel\"))(\"dragFileText\", i0.ɵɵpipeBind1(3, 8, \"dragFileLabel\"))(\"defaultMessage\", i0.ɵɵpipeBind1(4, 10, \"upload\"));\r\n} }\r\nfunction DynamicFileInputComponent_ng_container_0_clr_control_error_3_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"clr-control-error\", 9);\r\n    i0.ɵɵelement(1, \"span\", 10);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"translate\", \"validation.required\");\r\n} }\r\nfunction DynamicFileInputComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementContainerStart(0);\r\n    i0.ɵɵtemplate(1, DynamicFileInputComponent_ng_container_0_label_1_Template, 3, 3, \"label\", 1);\r\n    i0.ɵɵtemplate(2, DynamicFileInputComponent_ng_container_0_app_dropzone_2_Template, 5, 12, \"app-dropzone\", 2);\r\n    i0.ɵɵtemplate(3, DynamicFileInputComponent_ng_container_0_clr_control_error_3_Template, 2, 1, \"clr-control-error\", 3);\r\n    i0.ɵɵelementContainerEnd();\r\n} if (rf & 2) {\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showLabelAndDescription);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.dropzoneConfigs);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.control.hasError(\"required\") && ctx_r0.control.touched);\r\n} }\r\nexport class DynamicFileInputComponent {\r\n    constructor(inputType, path) {\r\n        this.inputType = inputType;\r\n        this.path = path;\r\n        this.controlDivContainerClass = \"clr-form-control\";\r\n        this.showLabelAndDescription = true;\r\n        this.addedEvent = new EventEmitter();\r\n        this.removedEvent = new EventEmitter();\r\n        this._destroy$ = createSubject();\r\n    }\r\n    ngOnInit() {\r\n        this.dropzoneConfigs = {\r\n            maxFiles: this.inputConfig.multiple ? 50 : 1,\r\n            maxFilesize: this.inputConfig.maxFileSize\r\n                ? this.inputConfig.maxFileSize\r\n                : 10,\r\n            url: isDefined(this.inputType.asFileInput(this.inputConfig).uploadUrl) &&\r\n                this.inputConfig.uploadUrl !== \"\"\r\n                ? this.inputConfig.uploadUrl\r\n                : this.path,\r\n            uploadMultiple: this.inputConfig.multiple\r\n                ? this.inputConfig.multiple\r\n                : false,\r\n            acceptedFiles: this.inputConfig.pattern,\r\n        };\r\n        this.control.valueChanges.pipe(map((state) => {\r\n            if (this.control.status.toLowerCase() === \"disabled\") {\r\n                this.dropzoneContainer.disabled = true;\r\n            }\r\n            else {\r\n                this.dropzoneContainer.disabled = false;\r\n            }\r\n            if (!isDefined(state)) {\r\n                this.dropzoneContainer.resetDropzone();\r\n            }\r\n        }));\r\n    }\r\n    // Files Handlers event method\r\n    // tslint:disable-next-line: typedef\r\n    async onDropzoneFileAdded() {\r\n        setTimeout(async () => {\r\n            const files = this.dropzoneContainer.dropzone().getAcceptedFiles();\r\n            if (this.inputConfig.multiple) {\r\n                this.control.setValue(await Promise.all(files.map(async (v) => {\r\n                    return {\r\n                        uuid: v.upload.uuid,\r\n                        dataURL: await readFileAsDataURI(v),\r\n                        extension: v.name.split(\".\")[v.name.split(\".\").length - 1],\r\n                    };\r\n                })));\r\n            }\r\n            else {\r\n                const file = files[0];\r\n                if (file) {\r\n                    this.control.setValue({\r\n                        uuid: files[0].upload.uuid,\r\n                        dataURL: await readFileAsDataURI(files[0]),\r\n                        extension: files[0].name.split(\".\")[files[0].name.split(\".\").length - 1],\r\n                    });\r\n                    this.dropzoneContainer.disabled = true;\r\n                }\r\n            }\r\n            this.addedEvent.emit(this.control.value);\r\n        }, 50);\r\n    }\r\n    // tslint:disable-next-line: typedef\r\n    onDropzoneFileRemoved(event) {\r\n        if (this.inputConfig.multiple) {\r\n            if (isDefined(this.control.value)) {\r\n                this.control.setValue(this.control.value.filter((v) => {\r\n                    return v.uuid !== event.upload.uuid;\r\n                }));\r\n            }\r\n        }\r\n        else {\r\n            this.control.setValue(null);\r\n        }\r\n        // Enable the dropzpone if an item is removed from the dropzone and not supporting multiple upload\r\n        if (!this.inputConfig.multiple) {\r\n            this.dropzoneContainer.disabled = false;\r\n        }\r\n        this.removedEvent.emit();\r\n    }\r\n    ngOnDestroy() {\r\n        this._destroy$.next();\r\n    }\r\n}\r\nDynamicFileInputComponent.ɵfac = function DynamicFileInputComponent_Factory(t) { return new (t || DynamicFileInputComponent)(i0.ɵɵdirectiveInject(i1.DynamicInputTypeHelper), i0.ɵɵdirectiveInject(\"FILE_STORE_PATH\")); };\r\nDynamicFileInputComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: DynamicFileInputComponent, selectors: [[\"app-dynamic-file-input\"]], viewQuery: function DynamicFileInputComponent_Query(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵviewQuery(_c0, 5);\r\n    } if (rf & 2) {\r\n        let _t;\r\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.dropzoneContainer = _t.first);\r\n    } }, inputs: { controlDivContainerClass: \"controlDivContainerClass\", control: \"control\", showLabelAndDescription: \"showLabelAndDescription\", inputConfig: \"inputConfig\" }, outputs: { addedEvent: \"addedEvent\", removedEvent: \"removedEvent\" }, decls: 1, vars: 1, consts: [[4, \"ngIf\"], [\"class\", \"clr-control-label\", 3, \"for\", 4, \"ngIf\"], [3, \"dropzoneConfig\", \"class\", \"uploadFileText\", \"dragFileText\", \"defaultMessage\", \"removedFile\", \"addedFile\", 4, \"ngIf\"], [\"class\", \"field-has-error\", 4, \"ngIf\"], [1, \"clr-control-label\", 3, \"for\"], [\"class\", \"required-text\", 4, \"ngIf\"], [1, \"required-text\"], [3, \"dropzoneConfig\", \"uploadFileText\", \"dragFileText\", \"defaultMessage\", \"removedFile\", \"addedFile\"], [\"dropzoneContainer\", \"\"], [1, \"field-has-error\"], [3, \"translate\"]], template: function DynamicFileInputComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, DynamicFileInputComponent_ng_container_0_Template, 4, 3, \"ng-container\", 0);\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", ctx.inputConfig);\r\n    } }, directives: [i2.NgIf, i3.ClrLabel, i4.DropzoneComponent, i3.ClrControlError, i5.TranslateDirective], pipes: [i5.TranslatePipe], styles: [\".required-text[_ngcontent-%COMP%], .field-has-error[_ngcontent-%COMP%]{color:#f13232}.clr-input-wrapper[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]:disabled{background:rgba(244,244,244,.3)}.clr-control-label[_ngcontent-%COMP%]{margin-bottom:.5rem}\"] });\r\n"]},"metadata":{},"sourceType":"module"}